//>>built
define("xstyle/core/expression",["xstyle/core/utils"],function(r){function m(f,d,a){return r.when(f,function(b){var e=d[0];return!b?a(e||b):e&&b.get?m(b.get(e),d.slice(1),a):b.receive?b.receive(e?function(b){m(b,d,a)}:a):e?m(b[e],d.slice(1),a):a(b)})}function v(f,d,a){m(f,d.slice(0,d.length-1),function(b){var e=d[d.length-1];b.set?b.set(e,a):b[e]=a})}var s={"true":!0,"false":!1,"null":"null","typeof":"typeof",or:"||",and:"\x26\x26"},w=1;return function(f,d,a){function b(){var a=g.length+1,b=[],c=
[],d,e,f,l=function(g){return function(n){if(!f&&(b[g]=n,a--,0>=a)){e=!0;d=p?p.apply(this,b):b[0];for(n=0;n<c.length;n++)c[n](d)}}};if(p)for(var q=0;q<g.length;q++){var k=g[q];m(k[0],k.slice(1),l(q))}else{var k=g[0],h={then:function(a){c?c.push(a):a(h)}};r.when(k[0],function(a){h=a;for(var b=1;b<k.length;b++)if(h&&h.get)h=h.get(k[b]);else{h={receive:function(c){m(a,k.slice(1),c)},put:function(c){v(a,k.slice(1),c)}};break}for(b=0;b<c.length;b++)c[b](h);c=null});return h}l(-1)();return d&&d.then?d:
{receive:function(b){c&&c.push(b);e&&b(d)},stop:function(){f=!0}}}var e=f["var-expr-"+d];if(g)return e;var g=[],t;g.id=w++;var u=[],l;a=a.join?a.join(""):a.toString();e=a.match(/^[\w_$\/\.-]*$/);a=a.replace(/("[^\"]*")|([\w_$\.\/-]+)/g,function(b,a,c){if(c){if(s.hasOwnProperty(c))return s[c];l=c.split("/");b=l.join("_").replace(/-/g,"_");u.push(b);g.push(l);a=l[0];c=f.getDefinition(a);if("string"==typeof c||c instanceof Array)c=evaluateExpression(f,a,c);else if(!c)throw Error('Could not find reference "'+
a+'"');c.forElement&&(t=!0);l[0]=c}return b});if(!e)var p=Function.apply(this,u.concat(["return ("+a+")"]));g.func=p;f["var-expr-"+d]=g;return f["var-expr-"+d]=t?{forElement:function(a){for(var d,c,e=0;e<g.length;e++){c=g[e];var f=c[0];f.forElement&&(f=c[0]=f.forElement(a));f=c=f.element;if(d)for(;c&&c!=d;)c=c.parentNode;c&&(d=f)}a=d["expr-result-"+g.id];a||(d["expr-result-"+g.id]=a=b(),a.element=d);return a}}:b()}});
//@ sourceMappingURL=expression.js.map